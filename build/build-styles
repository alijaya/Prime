#!/bin/bash
# script to build and run the css-parser

BUILDSCRIPTDIR="`dirname $0`";
PRJROOT="${BUILDSCRIPTDIR}/.."

MINPARAMS=1
Style=$1
MainClass="primevc.tools.CSSParserMain"
MainFile="${PRJROOT}/src/${MainClass//.//}.hx"		#replace all dots with slashes
Parser="${PRJROOT}/build/parser.n"
Force=false
#Resource=""

#parse arguments
while getopts "s:tfd" OptionName
	do
		case $OptionName in
			s ) Style=${OPTARG};;
			f ) Force=true;;
			d ) Debug="-debug";;
	esac
done

StyleFile=${Style}/Style.css

#echo "MainFile: ${MainFile}"
#echo "Main: ${MainClass}"
#echo "Style: ${StyleFile}"
#echo "Debugging? ${Debug:-false}"

#create parser if the source files have changed
if ${Force} || [[ ! -f ${Parser} ]]  ||  test ${MainFile} -nt ${Parser}  ; then  # ||  test ${StyleFile} -nt ${Parser} ; then
	echo "Compiling parser"
	haxe ${PRJROOT}/build/build-cssparser.hxml -main ${MainClass} -neko ${Parser} --no-inline ${Debug}
fi;

#compile css
if [[ -d ${Style} ]] && [[ -f ${StyleFile} ]] && [[ -f ${Parser} ]]; then
	echo "Running parser on ${StyleFile}"
	neko ${Parser} ${Style}
else
	echo "Style '${StyleFile}' doesn't exist!"
fi;